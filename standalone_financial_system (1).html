<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-6">
    <div id="app" class="max-w-7xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            
            <!-- Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 p-8 text-white">
                <div class="flex justify-between items-center flex-wrap gap-4">
                    <div>
                        <h1 class="text-3xl font-bold mb-2">Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø§Ù„ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†</h1>
                        <p class="text-indigo-100">Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙØ§Ø±Ø´Ø§ØªØŒ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ùˆ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù„ÛŒ - Ù‡Ù…Ù‡ Ú†ÛŒ Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©</p>
                    </div>
                    <button onclick="exportToCSV()" class="bg-white text-indigo-600 px-6 py-3 rounded-lg hover:bg-indigo-50 transition-colors flex items-center gap-2 font-semibold">
                        ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú¯Ø²Ø§Ø±Ø´ Excel
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 p-6 bg-gray-50">
                <div class="bg-white p-6 rounded-xl shadow-md border-r-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯</p>
                            <p id="totalRevenue" class="text-2xl font-bold text-green-600 mt-1">0 AED</p>
                        </div>
                        <span class="text-5xl opacity-20">ğŸ’°</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md border-r-4 border-red-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</p>
                            <p id="totalExpenses" class="text-2xl font-bold text-red-600 mt-1">0 AED</p>
                        </div>
                        <span class="text-5xl opacity-20">ğŸ“Š</span>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-xl shadow-md border-r-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ</p>
                            <p id="totalProfit" class="text-2xl font-bold text-blue-600 mt-1">0 AED</p>
                        </div>
                        <span class="text-5xl opacity-20">ğŸ’µ</span>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="border-b border-gray-200">
                <div class="flex gap-4 px-6">
                    <button onclick="showTab('customers')" id="tabCustomers" class="py-4 px-6 font-semibold transition-colors border-b-2 border-indigo-600 text-indigo-600">
                        Ù…Ø´ØªØ±ÛŒØ§Ù† Ùˆ Ø³ÙØ§Ø±Ø´Ø§Øª
                    </button>
                    <button onclick="showTab('expenses')" id="tabExpenses" class="py-4 px-6 font-semibold transition-colors text-gray-600 hover:text-indigo-600">
                        Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                    </button>
                    <button onclick="showTab('reports')" id="tabReports" class="py-4 px-6 font-semibold transition-colors text-gray-600 hover:text-indigo-600">
                        Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="p-6">
                <!-- Customers Tab -->
                <div id="customersContent">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Ù…Ø´ØªØ±ÛŒØ§Ù†</h2>
                        <button onclick="toggleAddCustomer()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2">
                            â• Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯
                        </button>
                    </div>

                    <!-- Add Customer Form -->
                    <div id="addCustomerForm" class="hidden bg-blue-50 p-6 rounded-lg mb-6 border border-blue-200">
                        <h3 class="font-bold text-lg mb-4">Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø´ØªØ±ÛŒ Ø¬Ø¯ÛŒØ¯ (Ú©Ø¯ Ùˆ ØªØ§Ø±ÛŒØ® Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" id="customerName" placeholder="Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ *" class="border border-gray-300 rounded-lg px-4 py-2">
                            <input type="text" id="customerProject" placeholder="Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)" class="border border-gray-300 rounded-lg px-4 py-2">
                            <input type="number" id="customerAmount" placeholder="Ù…Ø¨Ù„Øº ÙˆØ§Ø±ÛŒØ²ÛŒ (Ø¯Ø±Ù‡Ù…) *" class="border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div class="flex gap-3 mt-4">
                            <button onclick="saveCustomer()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Ø°Ø®ÛŒØ±Ù‡</button>
                            <button onclick="toggleAddCustomer()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition-colors">Ø§Ù†ØµØ±Ø§Ù</button>
                        </div>
                    </div>

                    <!-- Customers List -->
                    <div id="customersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>

                <!-- Expenses Tab -->
                <div id="expensesContent" class="hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</h2>
                        <button onclick="toggleAddExpense()" class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors flex items-center gap-2">
                            â• Ø§ÙØ²ÙˆØ¯Ù† Ù‡Ø²ÛŒÙ†Ù‡
                        </button>
                    </div>

                    <!-- Add Expense Form -->
                    <div id="addExpenseForm" class="hidden bg-red-50 p-6 rounded-lg mb-6 border border-red-200">
                        <h3 class="font-bold text-lg mb-4">Ø«Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø¬Ø¯ÛŒØ¯ (ØªØ§Ø±ÛŒØ® Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <select id="expenseCustomer" class="border border-gray-300 rounded-lg px-4 py-2">
                                <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ *</option>
                            </select>
                            <input type="text" id="expenseDescription" placeholder="Ø´Ø±Ø­ Ù‡Ø²ÛŒÙ†Ù‡ *" class="border border-gray-300 rounded-lg px-4 py-2">
                            <input type="number" id="expenseAmount" placeholder="Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…) *" class="border border-gray-300 rounded-lg px-4 py-2">
                        </div>
                        <div class="flex gap-3 mt-4">
                            <button onclick="saveExpense()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">Ø°Ø®ÛŒØ±Ù‡</button>
                            <button onclick="toggleAddExpense()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400 transition-colors">Ø§Ù†ØµØ±Ø§Ù</button>
                        </div>
                    </div>

                    <!-- Expenses List -->
                    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ú©Ø¯</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ù…Ø´ØªØ±ÛŒ</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ø´Ø±Ø­</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ù…Ø¨Ù„Øº</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">ØªØ§Ø±ÛŒØ®</th>
                                    <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="expensesList" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div id="reportsContent" class="hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ ØªÙØµÛŒÙ„ÛŒ</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border border-green-200">
                            <h3 class="font-bold text-lg mb-4 text-green-800">Ø®Ù„Ø§ØµÙ‡ Ù…Ø§Ù„ÛŒ</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´ØªØ±ÛŒØ§Ù†:</span>
                                    <span id="reportCustomersCount" class="font-bold text-xl">0</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">ØªØ¹Ø¯Ø§Ø¯ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:</span>
                                    <span id="reportExpensesCount" class="font-bold text-xl">0</span>
                                </div>
                                <div class="flex justify-between items-center pt-3 border-t border-green-300">
                                    <span class="text-gray-700">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† ÙˆØ§Ø±ÛŒØ² Ù‡Ø± Ù…Ø´ØªØ±ÛŒ:</span>
                                    <span id="reportAvgRevenue" class="font-bold text-green-700">0 AED</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl border border-blue-200">
                            <h3 class="font-bold text-lg mb-4 text-blue-800">Ù†Ø³Ø¨Øª Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ù‡ Ø¯Ø±Ø¢Ù…Ø¯</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Ø¯Ø±ØµØ¯ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§:</span>
                                    <span id="reportExpensePercent" class="font-bold text-xl text-red-600">0%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-700">Ø¯Ø±ØµØ¯ Ø³ÙˆØ¯:</span>
                                    <span id="reportProfitPercent" class="font-bold text-xl text-green-600">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-4 mt-4">
                                    <div id="reportProfitBar" class="bg-gradient-to-r from-green-500 to-blue-500 h-4 rounded-full transition-all" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Report Table -->
                    <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                            <h3 class="font-bold text-lg">Ú¯Ø²Ø§Ø±Ø´ ØªÙØµÛŒÙ„ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ú©Ø¯</th>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ù…Ø´ØªØ±ÛŒ</th>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ù¾Ø±ÙˆÚ˜Ù‡</th>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">ÙˆØ§Ø±ÛŒØ² Ø§ÙˆÙ„ÛŒÙ‡</th>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</th>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ù…Ø§Ù†Ø¯Ù‡</th>
                                        <th class="px-6 py-3 text-right text-xs font-semibold text-gray-700">Ø³ÙˆØ¯</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsList" class="divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let customers = JSON.parse(localStorage.getItem('customers') || '[]');
        let expenses = JSON.parse(localStorage.getItem('expenses') || '[]');

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US').format(amount) + ' AED';
        }

        function getCurrentDate() {
            return new Date().toLocaleDateString('en-GB');
        }

        function saveData() {
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('expenses', JSON.stringify(expenses));
        }

        function showTab(tab) {
            document.querySelectorAll('[id$="Content"]').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab"]').forEach(el => {
                el.classList.remove('border-b-2', 'border-indigo-600', 'text-indigo-600');
                el.classList.add('text-gray-600');
            });

            document.getElementById(tab + 'Content').classList.remove('hidden');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('border-b-2', 'border-indigo-600', 'text-indigo-600');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.remove('text-gray-600');

            if (tab === 'reports') renderReports();
        }

        function toggleAddCustomer() {
            document.getElementById('addCustomerForm').classList.toggle('hidden');
        }

        function toggleAddExpense() {
            document.getElementById('addExpenseForm').classList.toggle('hidden');
            updateExpenseCustomerList();
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value;
            const project = document.getElementById('customerProject').value;
            const amount = parseFloat(document.getElementById('customerAmount').value);

            if (!name || !amount) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ù…Ø´ØªØ±ÛŒ Ùˆ Ù…Ø¨Ù„Øº Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            customers.push({
                id: Date.now(),
                code: customers.length + 1,
                name: name,
                project: project,
                initialAmount: amount,
                date: getCurrentDate()
            });

            saveData();
            document.getElementById('customerName').value = '';
            document.getElementById('customerProject').value = '';
            document.getElementById('customerAmount').value = '';
            toggleAddCustomer();
            renderCustomers();
            updateStats();
        }

        function saveExpense() {
            const customerId = parseInt(document.getElementById('expenseCustomer').value);
            const description = document.getElementById('expenseDescription').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);

            if (!customerId || !description || !amount) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯!');
                return;
            }

            expenses.push({
                id: Date.now(),
                customerId: customerId,
                description: description,
                amount: amount,
                date: getCurrentDate()
            });

            saveData();
            document.getElementById('expenseCustomer').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';
            toggleAddExpense();
            renderExpenses();
            renderCustomers();
            updateStats();
        }

        function deleteCustomer(id) {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø´ØªØ±ÛŒ Ù‡Ù… Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯.')) return;
            
            customers = customers.filter(c => c.id !== id);
            expenses = expenses.filter(e => e.customerId !== id);
            saveData();
            renderCustomers();
            updateStats();
        }

        function deleteExpense(id) {
            if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù‡Ø²ÛŒÙ†Ù‡ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            
            expenses = expenses.filter(e => e.id !== id);
            saveData();
            renderExpenses();
            renderCustomers();
            updateStats();
        }

        function getCustomerExpenses(customerId) {
            return expenses.filter(e => e.customerId === customerId);
        }

        function getCustomerBalance(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return 0;
            
            const totalExpenses = getCustomerExpenses(customerId).reduce((sum, e) => sum + e.amount, 0);
            return customer.initialAmount - totalExpenses;
        }

        function getTotalRevenue() {
            return customers.reduce((sum, c) => sum + c.initialAmount, 0);
        }

        function getTotalExpenses() {
            return expenses.reduce((sum, e) => sum + e.amount, 0);
        }

        function getTotalProfit() {
            return getTotalRevenue() - getTotalExpenses();
        }

        function updateStats() {
            document.getElementById('totalRevenue').textContent = formatCurrency(getTotalRevenue());
            document.getElementById('totalExpenses').textContent = formatCurrency(getTotalExpenses());
            document.getElementById('totalProfit').textContent = formatCurrency(getTotalProfit());
        }

        function updateExpenseCustomerList() {
            const select = document.getElementById('expenseCustomer');
            select.innerHTML = '<option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø´ØªØ±ÛŒ *</option>';
            customers.forEach(c => {
                select.innerHTML += `<option value="${c.id}">Ú©Ø¯ ${c.code} - ${c.name} ${c.project ? '(' + c.project + ')' : ''}</option>`;
            });
        }

        function renderCustomers() {
            const list = document.getElementById('customersList');
            
            if (customers.length === 0) {
                list.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500"><p class="text-5xl mb-4">ğŸ‘¥</p><p>Ù‡Ù†ÙˆØ² Ù…Ø´ØªØ±ÛŒâ€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p></div>';
                return;
            }

            list.innerHTML = customers.map(customer => {
                const balance = getCustomerBalance(customer.id);
                const totalExpenses = getCustomerExpenses(customer.id).reduce((sum, e) => sum + e.amount, 0);
                const balanceColor = balance >= 0 ? 'text-blue-600' : 'text-red-600';

                return `
                    <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow-md transition-shadow">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold">Ú©Ø¯ ${customer.code}</span>
                                </div>
                                <h3 class="font-bold text-lg text-gray-800">${customer.name}</h3>
                                ${customer.project ? `<p class="text-sm text-gray-600">${customer.project}</p>` : ''}
                            </div>
                            <button onclick="deleteCustomer(${customer.id})" class="text-red-600 hover:text-red-700">ğŸ—‘ï¸</button>
                        </div>
                        
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">ÙˆØ§Ø±ÛŒØ² Ø§ÙˆÙ„ÛŒÙ‡:</span>
                                <span class="font-semibold text-green-600">${formatCurrency(customer.initialAmount)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Ù‡Ø²ÛŒÙ†Ù‡ Ø´Ø¯Ù‡:</span>
                                <span class="font-semibold text-red-600">${formatCurrency(totalExpenses)}</span>
                            </div>
                            <div class="flex justify-between pt-2 border-t border-gray-200">
                                <span class="text-gray-700 font-semibold">Ù…Ø§Ù†Ø¯Ù‡ Ø­Ø³Ø§Ø¨:</span>
                                <span class="font-bold ${balanceColor}">${formatCurrency(balance)}</span>
                            </div>
                        </div>
                        
                        <div class="mt-3 pt-3 border-t border-gray-200 text-xs text-gray-500">
                            ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª: ${customer.date}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderExpenses() {
            const list = document.getElementById('expensesList');
            
            if (expenses.length === 0) {
                list.innerHTML = '<tr><td colspan="6" class="text-center py-12 text-gray-500"><p class="text-5xl mb-4">ğŸ“„</p><p>Ù‡Ù†ÙˆØ² Ù‡Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p></td></tr>';
                return;
            }

            list.innerHTML = expenses.map(expense => {
                const customer = customers.find(c => c.id === expense.customerId);
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm">
                            <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold">${customer ? customer.code : '?'}</span>
                        </td>
                        <td class="px-6 py-4 text-sm">${customer ? customer.name + (customer.project ? ' - ' + customer.project : '') : 'Ù†Ø§Ù…Ø´Ø®Øµ'}</td>
                        <td class="px-6 py-4 text-sm">${expense.description}</td>
                        <td class="px-6 py-4 text-sm font-semibold text-red-600">${formatCurrency(expense.amount)}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${expense.date}</td>
                        <td class="px-6 py-4">
                            <button onclick="deleteExpense(${expense.id})" class="text-red-600 hover:text-red-700">ğŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function renderReports() {
            const revenue = getTotalRevenue();
            const totalExp = getTotalExpenses();
            const profit = getTotalProfit();

            document.getElementById('reportCustomersCount').textContent = customers.length;
            document.getElementById('reportExpensesCount').textContent = expenses.length;
            document.getElementById('reportAvgRevenue').textContent = customers.length > 0 ? formatCurrency(revenue / customers.length) : '0 AED';
            document.getElementById('reportExpensePercent').textContent = revenue > 0 ? ((totalExp / revenue) * 100).toFixed(1) + '%' : '0%';
            document.getElementById('reportProfitPercent').textContent = revenue > 0 ? ((profit / revenue) * 100).toFixed(1) + '%' : '0%';
            document.getElementById('reportProfitBar').style.width = (revenue > 0 ? (profit / revenue) * 100 : 0) + '%';

            const list = document.getElementById('reportsList');
            if (customers.length === 0) {
                list.innerHTML = '<tr><td colspan="7" class="text-center py-12 text-gray-500">Ù‡Ù†ÙˆØ² Ù…Ø´ØªØ±ÛŒâ€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</td></tr>';
                return;
            }

            list.innerHTML = customers.map(customer => {
                const totalExpenses = getCustomerExpenses(customer.id).reduce((sum, e) => sum + e.amount, 0);
                const balance = customer.initialAmount - totalExpenses;
                const balanceColor = balance >= 0 ? 'text-blue-600' : 'text-red-600';
                const profitColor = balance >= 0 ? 'text-green-600' : 'text-red-600';

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 text-sm">
                            <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold">${customer.code}</span>
                        </td>
                        <td class="px-6 py-4 text-sm font-medium">${customer.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${customer.project || '-'}</td>
                        <td class="px-6 py-4 text-sm text-green-600 font-semibold">${formatCurrency(customer.initialAmount)}</td>
                        <td class="px-6 py-4 text-sm text-red-600 font-semibold">${formatCurrency(totalExpenses)}</td>
                        <td class="px-6 py-4 text-sm font-semibold ${balanceColor}">${formatCurrency(balance)}</td>
                        <td class="px-6 py-4 text-sm font-semibold ${profitColor}">${formatCurrency(balance)}</td>
                    </tr>
                `;
            }).join('');
        }

        function exportToCSV() {
            let csv = 'Ú¯Ø²Ø§Ø±Ø´ Ù…Ø§Ù„ÛŒ Ø³ÛŒØ³ØªÙ…\n\n';
            csv += 'Ø®Ù„Ø§ØµÙ‡ Ù…Ø§Ù„ÛŒ:\n';
            csv += 'Ú©Ù„ Ø¯Ø±Ø¢Ù…Ø¯,' + getTotalRevenue() + '\n';
            csv += 'Ú©Ù„ Ù‡Ø²ÛŒÙ†Ù‡,' + getTotalExpenses() + '\n';
            csv += 'Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ,' + getTotalProfit() + '\n\n';
            
            csv += 'Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´ØªØ±ÛŒØ§Ù†:\n';
            csv += 'Ú©Ø¯,Ù†Ø§Ù…,Ù¾Ø±ÙˆÚ˜Ù‡,ÙˆØ§Ø±ÛŒØ²,Ù‡Ø²ÛŒÙ†Ù‡,Ù…Ø§Ù†Ø¯Ù‡,Ø³ÙˆØ¯\n';
            
            customers.forEach(customer => {
                const totalExpenses = getCustomerExpenses(customer.id).reduce((sum, e) => sum + e.amount, 0);
                const balance = customer.initialAmount - totalExpenses;
                csv += customer.code + ',' + customer.name + ',' + customer.project + ',' + customer.initialAmount + ',' + totalExpenses + ',' + balance + ',' + balance + '\n';
            });
            
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'financial_